{"ast":null,"code":"import _regeneratorRuntime from \"/Users/yoji/Desktop/Software engineer/Job hunting 2022.11/tablecheck-demo/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/Users/yoji/Desktop/Software engineer/Job hunting 2022.11/tablecheck-demo/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\n\nvar _jsxFileName = \"/Users/yoji/Desktop/Software engineer/Job hunting 2022.11/tablecheck-demo/src/Pages/Listing/index.tsx\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useEffect, useState } from 'react';\nimport { SpinnerSize } from '@tablecheck/tablekit-spinner';\nimport { useLocation } from 'react-router-dom';\nimport { ListingSpinner } from '../../styles/index';\nimport { LeftDiv, ListingWrapper, RightDiv, ShopContainer, ShopLink } from './styles';\nexport function Listing() {\n  _s();\n\n  var _this = this;\n\n  var _useState = useState([{\n    _id: '',\n    name: '',\n    slug: '',\n    cuisines: [],\n    content_title_translations: [{\n      translation: ''\n    }],\n    search_image: ''\n  }]),\n      shopList = _useState[0],\n      setShopList = _useState[1];\n\n  var _useState2 = useState(false),\n      isLoading = _useState2[0],\n      setIsLoading = _useState2[1];\n\n  var location = useLocation();\n  var geoCoordinates = location.state;\n  var queryParams = new URLSearchParams(window.location.search);\n  var term = queryParams.get('term');\n\n  var getListing = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n      var res, data;\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              setIsLoading(function (prev) {\n                return !prev;\n              });\n              _context.next = 4;\n              return fetch(\"https://staging-snap.tablecheck.com/v2/shop_search?geo_latitude=\".concat(geoCoordinates.lat, \"&geo_longitude=\").concat(geoCoordinates.lon, \"&shop_universe_id=57e0b91744aea12988000001&locale=en&per_page=50\"));\n\n            case 4:\n              res = _context.sent;\n\n              if (!(res.status !== 200)) {\n                _context.next = 8;\n                break;\n              }\n\n              alert('Error happened. Please try again later.');\n              throw new Error('Error happened. Please try again later.');\n\n            case 8:\n              _context.next = 10;\n              return res.json();\n\n            case 10:\n              data = _context.sent;\n              console.log(data);\n              setShopList(data.shops);\n              setIsLoading(function (prev) {\n                return !prev;\n              });\n              _context.next = 19;\n              break;\n\n            case 16:\n              _context.prev = 16;\n              _context.t0 = _context[\"catch\"](0);\n              console.error(_context.t0);\n\n            case 19:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 16]]);\n    }));\n\n    return function getListing() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var updateListing = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n      var res, data;\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.prev = 0;\n              setIsLoading(function (prev) {\n                return !prev;\n              });\n              _context2.next = 4;\n              return fetch(\"https://staging-snap.tablecheck.com/v2/autocomplete?locale=en&shop_universe_id=57e0b91744aea12988000001&text=\".concat(term));\n\n            case 4:\n              res = _context2.sent;\n\n              if (!(res.status !== 200)) {\n                _context2.next = 8;\n                break;\n              }\n\n              alert('Error happened. Please try again later.');\n              throw new Error('Error happened. Please try again later.');\n\n            case 8:\n              _context2.next = 10;\n              return res.json();\n\n            case 10:\n              data = _context2.sent;\n              geoCoordinates = data.locations[0].payload.geo;\n              getListing();\n              setIsLoading(function (prev) {\n                return !prev;\n              });\n              _context2.next = 19;\n              break;\n\n            case 16:\n              _context2.prev = 16;\n              _context2.t0 = _context2[\"catch\"](0);\n              console.error(_context2.t0);\n\n            case 19:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[0, 16]]);\n    }));\n\n    return function updateListing() {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    if (!term) {\n      getListing();\n    } else {\n      updateListing(); // make the url with query loadable\n    }\n  }, [term]);\n  return __jsx(React.Fragment, null, isLoading ? __jsx(ListingSpinner, {\n    size: SpinnerSize.Large,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 9\n    }\n  }) : __jsx(ListingWrapper, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, shopList.map(function (shop) {\n    return __jsx(ShopLink, {\n      to: shop.slug,\n      key: shop._id,\n      state: shop.slug,\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 13\n      }\n    }, __jsx(ShopContainer, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 15\n      }\n    }, __jsx(LeftDiv, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 17\n      }\n    }, __jsx(\"img\", {\n      src: shop.search_image,\n      alt: \"thumbnail\",\n      style: {\n        width: '100%',\n        height: '100%',\n        objectFit: 'cover'\n      },\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 19\n      }\n    })), __jsx(RightDiv, {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 17\n      }\n    }, shop.name.length === 1 ? __jsx(\"h3\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116,\n        columnNumber: 21\n      }\n    }, shop.name[0]) : shop.name.length > 1 ? __jsx(\"h3\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 118,\n        columnNumber: 21\n      }\n    }, shop.name[1]) : __jsx(React.Fragment, null), __jsx(\"p\", {\n      __self: _this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 122,\n        columnNumber: 19\n      }\n    }, shop.cuisines.map(function (cuisine, idx) {\n      return __jsx(\"span\", {\n        key: idx,\n        __self: _this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124,\n          columnNumber: 23\n        }\n      }, cuisine, \" \");\n    })))));\n  })));\n}\n\n_s(Listing, \"HuIWYMvqLOKlBwkrlw7eHBZrro8=\", false, function () {\n  return [useLocation];\n});\n\n_c = Listing;\n\nvar _c;\n\n$RefreshReg$(_c, \"Listing\");","map":{"version":3,"names":["useEffect","useState","SpinnerSize","useLocation","ListingSpinner","LeftDiv","ListingWrapper","RightDiv","ShopContainer","ShopLink","Listing","_id","name","slug","cuisines","content_title_translations","translation","search_image","shopList","setShopList","isLoading","setIsLoading","location","geoCoordinates","state","queryParams","URLSearchParams","window","search","term","get","getListing","prev","fetch","lat","lon","res","status","alert","Error","json","data","console","log","shops","error","updateListing","locations","payload","geo","Large","map","shop","width","height","objectFit","length","cuisine","idx"],"sources":["/Users/yoji/Desktop/Software engineer/Job hunting 2022.11/tablecheck-demo/src/Pages/Listing/index.tsx"],"sourcesContent":["import { useEffect, useState } from 'react'\nimport { SpinnerSize } from '@tablecheck/tablekit-spinner'\nimport { useLocation } from 'react-router-dom'\nimport { ListingSpinner } from '../../styles/index'\nimport {\n  LeftDiv,\n  ListingWrapper,\n  RightDiv,\n  ShopContainer,\n  ShopLink,\n} from './styles'\n\ntype ShopList = {\n  _id: string\n  name: string\n  slug: string\n  cuisines: string[]\n  content_title_translations: { translation: string }[]\n  search_image: string\n}\n\ntype Geo = {\n  lat: string\n  lon: string\n}\n\nexport function Listing(): JSX.Element {\n  const [shopList, setShopList] = useState<ShopList[]>([\n    {\n      _id: '',\n      name: '',\n      slug: '',\n      cuisines: [],\n      content_title_translations: [{ translation: '' }],\n      search_image: '',\n    },\n  ])\n\n  const [isLoading, setIsLoading] = useState(false)\n\n  const location = useLocation()\n  let geoCoordinates = location.state as Geo\n\n  const queryParams = new URLSearchParams(window.location.search)\n  const term = queryParams.get('term')\n\n  const getListing = async () => {\n    try {\n      setIsLoading((prev) => !prev)\n      const res = await fetch(\n        `https://staging-snap.tablecheck.com/v2/shop_search?geo_latitude=${geoCoordinates.lat}&geo_longitude=${geoCoordinates.lon}&shop_universe_id=57e0b91744aea12988000001&locale=en&per_page=50`,\n      )\n      if (res.status !== 200) {\n        alert('Error happened. Please try again later.')\n        throw new Error('Error happened. Please try again later.')\n      }\n      const data = await res.json()\n      console.log(data)\n\n      setShopList(data.shops)\n      setIsLoading((prev) => !prev)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  const updateListing = async () => {\n    try {\n      setIsLoading((prev) => !prev)\n      const res = await fetch(\n        `https://staging-snap.tablecheck.com/v2/autocomplete?locale=en&shop_universe_id=57e0b91744aea12988000001&text=${term}`,\n      )\n      if (res.status !== 200) {\n        alert('Error happened. Please try again later.')\n        throw new Error('Error happened. Please try again later.')\n      }\n      const data = await res.json()\n      geoCoordinates = data.locations[0].payload.geo\n      getListing()\n      setIsLoading((prev) => !prev)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  useEffect(() => {\n    if (!term) {\n      getListing()\n    } else {\n      updateListing() // make the url with query loadable\n    }\n  }, [term])\n\n  return (\n    <>\n      {isLoading ? (\n        <ListingSpinner size={SpinnerSize.Large} />\n      ) : (\n        <ListingWrapper>\n          {shopList.map((shop) => (\n            <ShopLink to={shop.slug} key={shop._id} state={shop.slug}>\n              <ShopContainer>\n                <LeftDiv>\n                  <img\n                    src={shop.search_image}\n                    alt=\"thumbnail\"\n                    style={{\n                      width: '100%',\n                      height: '100%',\n                      objectFit: 'cover',\n                    }}\n                  />\n                </LeftDiv>\n                <RightDiv>\n                  {shop.name.length === 1 ? (\n                    <h3>{shop.name[0]}</h3>\n                  ) : shop.name.length > 1 ? (\n                    <h3>{shop.name[1]}</h3>\n                  ) : (\n                    <></>\n                  )}\n                  <p>\n                    {shop.cuisines.map((cuisine, idx) => (\n                      <span key={idx}>{cuisine} </span>\n                    ))}\n                  </p>\n                </RightDiv>\n              </ShopContainer>\n            </ShopLink>\n          ))}\n        </ListingWrapper>\n      )}\n    </>\n  )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}